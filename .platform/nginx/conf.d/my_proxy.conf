# Nginx configuration placed in .platform/nginx/conf.d/my_proxy.conf

# Define the root directory for static files
root /var/app/current;

# Handle root path requests - serve index.html
location / {
    try_files $uri $uri/ /index.html;
}

# Handle requests for static files (images, js, css, etc.)
location ~ ^/(images/|script\.js|sub\.js|.*\.css|.*\.html) {
    try_files $uri =404;
    expires 1d; # Optional: cache static files
}

# Handle API requests by proxying to the backend Gunicorn server
location /api {
    proxy_pass          http://127.0.0.1:8000; # Gunicorn should be listening here
    proxy_http_version  1.1;

    # Standard proxy headers
    proxy_set_header    Connection          $connection_upgrade;
    proxy_set_header    Upgrade             $http_upgrade;
    proxy_set_header    Host                $host;
    proxy_set_header    X-Real-IP           $remote_addr;
    proxy_set_header    X-Forwarded-For     $proxy_add_x_forwarded_for;
    proxy_set_header    X-Forwarded-Proto   $scheme;
    proxy_set_header    X-Forwarded-Port    $server_port;
}

# It's usually good to include Elastic Beanstalk's health check configuration
# This file might be slightly different based on platform version
include /etc/nginx/conf.d/elasticbeanstalk/healthd.conf;